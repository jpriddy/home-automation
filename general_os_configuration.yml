---
- name: Configure OS
  hosts: all
  become: yes
  tasks:
  
    - name: Install various packages
      package:
        name: "{{ item }}"
        state: latest
      with_items:
        - cockpit
        - netdata
        - pcp
        - auto
        - autofs
        - bash-completion
        - cifs-utils
        - kexec-tools
        - mlocate
        - pcp
        - rsync
        - sos
        - sysstat
        - tuned
        - deltarpm
        - cockpit
        - chkconfig
        - ipa-client
        - nmap
        - iperf3
        - chrony
        
    - name: Configure chrony and restart it
      lineinfile:
        path: /etc/chrony.conf
        regexp: '^server'
        line: 'server 192.168.1.1 iburst'
        state: present
        create: yes
      notify:
        - restart chrony

    - name: Allow root login via ssh
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: '^#?(PermitRootLogin|PermitRootLogin without-password)'
        line: 'PermitRootLogin yes'
      backup: yes

    - name: Restart SSH service
      service:
        name: sshd
        state: restarted

#    - name: Disable IPv6 via sysctl
#      sysctl:
#        name: net.ipv6.conf.all.disable_ipv6
#        value: 1
#        state: present
#        reload: yes
#
#    - name: Set up automount
#      get_url:
#        url: "{{ item.src }}"
#        dest: "{{ item.dest }}"
#      with_items:
#        - { src: "http://synology.jpriddy.com/kickstart/files/synology.autofs", dest: "/etc/automaster.d/synology.autofs" }
#        - { src: "http://synology.jpriddy.com/kickstart/files/auto.synology", dest: "/etc/auto.synology" }
#        - { src: "http://synology.jpriddy.com/kickstart/files/.synology", dest: "/root/.synology" }
